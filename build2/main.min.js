define("webapp/business/guidelayer.html",'<div class="guide-larer"><div class="guide-top"><div class="guide-left"></div><div class="guide-right"></div></div><div class="fri-empty"><span class="arrow"></span><div><em>1</em>点击右上角扫码身边好友</div><div><em>2</em>当你像往常一样在听歌时，朋友可以看到你的动态，同步听你在听的歌哦</div><div><em>3</em>只有两步╰(￣▽￣)╮</div><div class="fri-image"></div><!--<div class="fri-foot2"><div>好友没有天天动听？没关系～</div><div>分享到<span class="icon-weixin"></span>微信<span class="icon-qq"></span>QQ</div><div>邀请朋友来同步听歌吧～ </div></div>--></div></div>');
define("webapp/templates/home.html",'<ul class="frilist js_fribox"><!--<li><img class="fri-avatar" src="./avatars/1.png"/><span class="fri-center"><strong class="fri-name">Name</strong><span class="fri-state">他在听歌...</span></span><span class="fri-btn"><i class="icon-eye"></i>去看看</span></li><li><img class="fri-avatar" src="./avatars/2.png"/><span class="fri-center"><strong class="fri-name">Name</strong><span class="fri-state">他在听歌...</span></span><span class="fri-btn"><i class="icon-headset"></i>去看看</span></li><li><img class="fri-avatar" src="./avatars/2.png"/><span class="fri-center"><strong class="fri-name">Name</strong><span class="fri-state">他在听歌...</span></span><span class="fri-btn"><i class="icon-headset"></i>去看看</span></li><li class="fri-add"><span class="fri-add-icon"></span><div>点击这里加好友，跟TA一起听</div></li>--></ul><script type="text/template" id="tpl_friitem"><%_.each(list,function(o){%><li data-uid="<%=o._id%>"><i class="target"></i><img class="fri-avatar" src="<%=(o.pic||defaultHand)%>"/><span class="fri-center"><strong class="fri-name"><%=o.nickName%></strong><span class="fri-state"></span></span><span class="fri-btn js_eyebtn"><i class="icon-eye"></i>去看看</span><span class="fri-btn js_headsetbtn"><i class="icon-headset"></i>去听听</span></li><%});%><%if(list && list.length < 8 && false){%><li class="fri-add"><span class="fri-add-icon"></span><div>点击这里加好友，跟TA一起听</div></li><%}%><li class="fri-share js_share"></li><%if((!list || !list.length) && false){%><!--<li class="fri-empty"><span class="arrow"></span><div><em>1</em>点击右上角扫码身边好友</div><div><em>2</em>当你像往常一样在听歌时，朋友可以看到你的动态，同步听你在听的歌哦</div><div><em>3</em>只有两步╰(￣▽￣)╮</div></li>--><%}%></script>');
define("webapp/templates/index.html","");
define("webapp/templates/friend/add.html",'<div class="qrbox-bg add-page"><div class="qrbox"></div><div class="qrbox-tit">请朋友扫一扫，开启一起听歌的乐趣</div></div>');
define("webapp/templates/friend/avatar.html",'<ul class="f-a-list imgbox"><li><div><img src="./avatars/1.png"/></div></li><li><div><img src="./avatars/2.png"/></div></li><li><div><img src="./avatars/3.png"/></div></li><li><div><img src="./avatars/4.png"/></div></li><li><div><img src="./avatars/5.png"/></div></li><li><div><img src="./avatars/6.png"/></div></li><li><div><img src="./avatars/7.png"/></div></li><li><div><img src="./avatars/8.png"/></div></li><li><div><img src="./avatars/9.png"/></div></li></ul>');
define("webapp/templates/friend/confirm.html",'<div class="f-conf-box js-body"></div><script type="text/template" id="tpl-body"><div class="f-conf-head"><div class="f-conf-avatar"><img src="<%=(data.pic||defaultHand)%>"/></div><div class="f-conf-name"><%=data.nickName%></div></div><div class="f-conf-link"><div class="btn-link f-conf-play js-play-to-her">选首歌给TA听</div><div class="btn-link js-listener-her">听听TA的歌</div></div></script>');
define("webapp/templates/friend/detail.html",'<div><div class="topage">前往扫描页面</div></div><div class="friend-info"></div>');
define("webapp/templates/friend/edit.html",'<div class="f-e-box js_body"></div><script type="text/template" id="tpl-body"><div class="f-e-avatar"><%if(user.picUrl){%><img src="<%=user.picUrl%>" class="pic"/><%}else{%><span class="select-avatar">选择头像</span><%}%><input type="hidden" value="<%=user.picUrl%>" id="pic"/></div><div class="f-e-name"><input type="text" placeholder="快给TA取个昵称吧～" value="<%=user.nickName%>" class="nickname" id="nickname"/></div></script>');
define("webapp/templates/listener/play.html",'<div class="play-bg"><div class="play-bg-mask"></div></div><div class="l-p-box"><div class="l-p-info"><div class="l-p-avatar "><img class="js_avatar" src="about:blank"/></div><div class="l-p-name js_name"></div></div><div class="l-p-songinfo js_songinfo"></div></div><div class="l-p-lrc js_lrcbox"></div>');
define("webapp/templates/master/home.html",'<div class="play-bg"><div class="play-bg-mask"></div></div><div class="l-p-box"><div class="h-listenlist-box"></div><div class="l-p-songinfo js_songinfo">珊瑚海 - 周杰伦</div></div><div class="l-p-lrc m-home-lrc js_lrcbox"></div>');
define("webapp/templates/share/master.html",'<div class="gl-bg-mask"></div><div class="sh-body"><div class="sh-listeners"></div><div class="sh-info-box ">å	</div></div><div class="sh-logo"></div><script type="text/template" id="tpl_listeners"><ul><%_.each(list,function(o){%><li><span class="sh-avatar"><img src="<%=(o.pic||defaultHand)%>"/></span><span class="sh-name"><%=o.nickName%></span></li><%});%></ul></script><script type="text/template" id="tpl_listen_info"><div class="sh-record-info-box"><div class="sh-record-info"><div class="sh-re-left sh-r"><span>我们共度的音乐时光</span><strong><%=totalTime%></strong><span>分钟</span></div><div class="sh-re-right sh-r"><span>一起听</span><strong><%=songs%></strong><span>首歌</span></div></div></div><%if(songName){%><div class="sh-recordsong-info-box"><div class="sh-recordsong-info"><div style="display:none" class="sh-re-img"><img src="<%=albumpic%>"/></div><div class="sh-re-songname"><span>最近听的一首歌</span><span>《<%=songName%>》</span></div></div></div><%}%></script>');
define("webapp/templates/share/play.html",'<div class="play-box"><div class="play-bg"><div class="play-bg-mask"></div></div><div class="play-status"><div class="l-p-box "><div class="l-p-info"><div class="l-p-songinfo js_songinfo"><span class="l-songname"></span><span class="l-singler"></span></div></div></div><div class="l-p-lrc js_lrcbox"></div></div><div class="status-user-empty"><h3>- 听完啦 -</h3><div class="status-tit"><span class="first">想跟好友一起听更多的歌吗？</span><span>快去天天动听吧~</span></div><div class="status-userbg"></div></div><div class="open-app-box"><button class="open-app js_openapp">打开天天动听</button></div></div>');
define("webapp/app.config.js",[],function(require){return{viewpath:"webapp/views/",templatepath:"webapp/templates/",defaultFrame:"main",frames:{main:{viewpath:"webapp/views/",templatepath:"webapp/templates/",framebox:"main",defaultView:"index"}}}});
define("webapp/business/guidelayer.js",["base/base","ui/layer","text!webapp/business/guidelayer.html"],function(require){var e=require("base/base"),t=require("ui/layer"),i=require("text!webapp/business/guidelayer.html"),n=function(){};return t.extend({propertys:function(){this.topRightHandle=n,this.centerHandle=function(){this.hide()},this.useMask=!1,this.on("create",function(){this.$el.addClass("ui-guide-layer"),this.$el.on("click",".guide-right",function(){this.topRightHandle()}.bind(this)),this.$el.on("click",".fri-empty",function(){this.centerHandle()}.bind(this))})},createHTML:function(){return i},initialize:function($super,e){e=e||{},e.items=[],$super(e)},setOption:function($super,t){$super(t),e.isNUL(t.topRightHandle)||(this.topRightHandle=t.topRightHandle),e.isNUL(t.centerHandle)||(this.centerHandle=t.centerHandle)}})});
define("webapp/common/app.js",["app/base"],function(require){function n(){}function e(n,e,a){return a=a||{},e&&(a.params=e),l.call(n,a)}var l=require("app/base");"ListenWithBridge"in window&&l.setSendHandle(function(n){window.ListenWithBridge.onNewCall(n)});var a={},i={callback:n,error:n,cancel:n};return a.createQR=function(n,l){e("createQR",n,l||i)},a.scanQR=function(n){e("scanQR",null,n||i)},a.play=function(n,l){e("play",n,l||i)},a.pause=function(n){e("pause",null,n||i)},a.resume=function(n){e("resume",null,n||i)},a.listenPlayInfo=function(n){e("listen_play_info",null,n||i)},a.unListenPlayInfo=function(n){e("un_listen_play_info",null,n||i)},a.getPlayInfo=function(n){e("play_info",null,n||i)},a.getUserInfo=function(n){e("user_info",null,n||i)},a.share=function(n){e("share",null,n||i)},a.backApp=function(n){a.openAppSendMessage(),setTimeout(function(){e("exit",null,n||i)},0)},a.handler_back=function(n){e("handler_back",null,n||i)},a.closeAppSendMessage=function(n){},a.openAppSendMessage=function(n){},a});
define("webapp/common/basemodel.js",["model/form.model"],function(require){var n=require("model/form.model");return n.extend({propertys:function(){},initialize:function($super,n){$super(n)},buildBaseUrl:function(){return"http://api.liveroom.ttpod.com/liveroom"},buildParam:function(){return null},buildResult:function(){return null}})});
define("webapp/common/baseview.js",["mvc/view","webapp/common/app","webapp/models/models","webapp/stores/stores","webapp/common/global.const"],function(require){var t=require("mvc/view"),e=require("webapp/common/app"),n=require("webapp/models/models"),i=require("webapp/stores/stores");require("webapp/common/global.const");var a=i.UserStore.getInstance(),s="head-left-btn",o="head-title",d="head-right-btn",c=['<span class="btn '+s+'"<%if(hideLeftBtn){%> style="display:none"<%}%>></span>','<h3 class="'+o+'"><%=title%></h3>','<span class="btn '+d+'"<%if(hideRightBtn){%> style="display:none"<%}%>><%=rightTitle%></span>'].join("");return t.extend({propertys:function(){},initialize:function($super,t){$super(t)},setHeader:function(t){var n={};t.leftHandle&&(n["click ."+s]=t.leftHandle),window.app=window.app||{},window.app.__back=function(){t.leftHandle&&t.leftHandle.call(this),e.handler_back()}.bind(this),t.rightHandle&&(n["click ."+d]=t.rightHandle),this.toHead(this.id,{template:c,cls:t.cls,data:{title:t.title,rightTitle:t.rightTitle,hideRightBtn:t.hideRightBtn,hideLeftBtn:t.hideLeftBtn},events:n,notAnimte:t.notAnimte,space:this})},isHeaderHidden:function(){return!this.frame.header.box.height()},getUid:function(t){var i=this;e.getUserInfo({callback:function(e){var s=e.user_id,o=encodeURIComponent(e.utdid),d=a.getAttr("user"+o);if(d)return void t.call(i,d);var c=n.CreateUidModel.getInstance();c.setParam({userid:s,utdid:o}),c.request({success:function(e){a.setAttr("user"+o,e.data),t.call(i,e.data)},error:function(){i.hideLoading(),i.showToast("大家太热情了，请等下再试~",3)},cancel:function(){i.hideLoading()}})},error:function(){i.hideLoading(),i.showToast("小天有点忙，退出再重新进入~",3)},timeoutfn:function(){i.hideLoading(),i.showToast("小天有点忙，退出再重新进入~",3)},timeout:3})},getUser:function(t){this.getUid(function(e){this.getUserByUid(e._id,t)})},setBackground:function(t,e){var n=this.getRootBg();n.css("background",t),e&&n.css("background-size",e)},getUserByUid:function(t,e){var i=n.UserInfoModel.getInstance();i.setParam("uid",t),i.request({success:function(t){e.call(this,t.data)},error:function(){this.hideLoading(),this.showToast("获得用户信息失败！")},cancel:function(){this.hideLoading()}},this)},$T:function(t){return _.template(this.$(t).html())}})});
define("webapp/common/global.const.js",[],function(require){return window.defaultHand="./avatars/defaulthand2.png",window.defaultCover="./images/background.jpg",window.defaultMinCover="./images/bg.png",{}});
define("webapp/common/oldapp.js",[],function(require){var o=function(){var o=$("body");return function(t){var e=$('<iframe src="'+t+'" style="width:0px;height:0px;overflow:hidden;position:absolute;left:-999px;top:-999px;"></iframe>');o.append(e),setTimeout(function(){e.remove(),e=null},800)}}(),t={};return t.protocol="ttpod://",t.send=function(e,n){n=n||{};var p=$.param(n),r=t.protocol+e+(p?"?"+p:"");o(r)},t});
define("webapp/common/userslide.js",["base/base","ui/slide"],function(require){var e=require("base/base"),i=require("ui/slide"),t="l-page-wraper",s='<table><tr><td><div class="'+t+'"></div></td></tr></table>';return i.extend({propertys:function(){this.pageSize=3,this.itemTemplate=_.template(['<div class="h-list-item">','<div class="l-p-info">','<div class="l-p-avatar"><img src="<%=pic%>"/></div>','<div class="l-p-name"><%=nickname%></div>',"</div>","</div>"].join("")),this.userItems=[],this.on("create",function(){this.emit("update")}),this.on("update",function(){this.update()})},initialize:function($super,e){e=e||{},e.items=[],$super(e)},setOption:function($super,e){$super(e),e.pageSize&&(this.pageSize=e.pageSize),e.itemTemplate&&(this.itemTemplate=e.itemTemplate),e.userItems&&(this.userItems=e.userItems)},setUserItems:function(e){this.userItems=e},update:function(){this.subbox.empty(),this.$el.find(".ui-slide-nav").empty();var i={},a=this;this.userItems=this.userItems||[],e.each(this.userItems,function(e,t){t+=1;var s=Math.ceil(t/a.pageSize);pageitems=i[s]=i[s]||[],pageitems.push(a.itemTemplate(e))});var n=Math.ceil(this.userItems.length/this.pageSize);1>=n&&this.$el.find(".ui-slide-nav").hide(),e.each(i,function(e,i){var n=e.join(""),m=$(s);m.find("."+t).html(n);var h=m.find(".h-list-item"),l=100/h.length;h.css("width",l+"%"),a.add(m)}),this.emit("resize")}})});
define("webapp/models/models.js",["base/base","webapp/common/basemodel"],function(require){var e=require("base/base"),t=require("webapp/common/basemodel"),r={};return r.CreateUidModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"/user/{userid}/{utdid}"},fieldsGet:function(){return[]}}),r.FriendListModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"/user/{uid}/friends"},findFriendByUid:function(t,r){var n=null;return e.each(r,function(e,t){return e._id==t?(n=e,!0):void 0}),n}}),r.MyFriendUserInfoModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"/user/{uid}/friends/{friendid}"}}),r.UserInfoModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"/user/{uid}"}}),r.UserInviteModel=t.extend({propertys:function(){this.type="POST"},buildUrl:function(){return"/user/{uid}/invite"}}),r.UserQRModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"/user/qr/{qrid}"}}),r.UserEditModel=t.extend({propertys:function(){this.type="PUT"},buildUrl:function(){return"/user/{uid}"}}),r.MyFollowMasterModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"/master/masters"}}),r.MasterPlayStatusModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"master/{masterid}/listeners"}}),r.ListenerHeartBeatModel=t.extend({propertys:function(){this.type="POST"},buildUrl:function(){return"master/{masterid}/listeners"}}),r.ListenerLeaveModel=t.extend({propertys:function(){this.type="DELETE"},buildUrl:function(){return"/master/{masterid}/listeners"}}),r.MasterInfoModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"master/{masterid}"}}),r.ListenerOfMyModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"/master/{uid}/listener"}}),r.MyListenerRecordModel=t.extend({propertys:function(){this.type="GET"},buildUrl:function(){return"master/records/{masterId}"}}),r.LrcSearchModel=t.extend({propertys:function(){this.type="GET"},buildBaseUrl:function(){return""},buildUrl:function(){return"/ajax/so.ard.iyyin.com/s/lyric"}}),r.LrcDownloadModel=t.extend({propertys:function(){this.dataType="text",this.type="get"},buildBaseUrl:function(){return""},buildUrl:function(){return"/ajax/lyric.ttpod.com/{url}"},request:function($super,e,t){var n=r.LrcSearchModel.getInstance(),i=this.getParam(),o=i.id,s=this;n.setParam("song_id",o),n.request({success:function(t){t=t.data&&t.data[0]||{},t&&t.content_url?(s.setParam("url",t.content_url.replace("http://lyric.ttpod.com/","")),$super({success:function(t){e.success&&e.success(t)},error:function(){e.error&&e.error({code:2,message:"没有找到歌词！"})}})):e.error&&e.error({code:2,message:"没有找到歌词！"})},error:function(){e.error&&e.error({code:1,message:"网络错误！"})}})}}),r.ExitRoomModel=t.extend({propertys:function(){this.type="PUT"},buildParam:function(){return{songId:0,action:4,position:0}},buildUrl:function(){return"/master/{masterid}"}}),r.LrcTestModel=t.extend({propertys:function(){this.type="GET",this.dataType="text"},buildBaseUrl:function(){return""},buildUrl:function(){return"/lrc.txt"}}),r.SongSerachModel=t.extend({propertys:function(){this.type="GET",this.dataType="jsonp"},buildBaseUrl:function(){return"http://ting.hotchanson.com"},buildUrl:function(){return"/v2/songs/downwhite?callback=?"}}),r.SharePostModel=t.extend({propertys:function(){this.type="POST"},buildUrl:function(){return"share"}}),r.SharePvCountPutModel=t.extend({propertys:function(){this.type="PUT"},buildUrl:function(){return"share/pvCount"}}),r.SharePvCountGetModel=t.extend({propertys:function(){this.type="POST"},buildUrl:function(){return"share/pvCount"}}),r});
define("webapp/stores/stores.js",["storage/local.store","common/funs"],function(require){var e=require("storage/local.store"),t=(require("common/funs"),{});return t.UserStore=e.extend({buildName:function(){return"TTPOD_USER"},buildTimeout:function(){return"1I"}}),t.UidStore=e.extend({buildName:function(){return"TTPOD_UID"},buildTimeout:function(){return"30S"}}),t.FirstStore=e.extend({buildName:function(){return"TTPOD_FIRST"},buildTimeout:function(){return"70Y"}}),t.UserEditStore=e.extend({buildName:function(){return"TTPOD_SESSION"},buildTimeout:function(){return"7D"}}),t});
define("webapp/views/home.js",["webapp/common/baseview","common/lrcview","webapp/common/app","webapp/common/oldapp","text!webapp/templates/home.html","webapp/common/userslide","webapp/models/models","webapp/business/guidelayer","base/log","ui/dialog"],function(require){var t=require("webapp/common/baseview"),e=(require("common/lrcview"),require("webapp/common/app")),i=require("webapp/common/oldapp"),a=require("text!webapp/templates/home.html"),s=(require("webapp/common/userslide"),require("webapp/models/models")),n=require("webapp/business/guidelayer"),o=(require("base/log"),require("ui/dialog")),r=s.FriendListModel.createLazyFun(),d=s.MyFollowMasterModel.createLazyFun(),h=s.ListenerOfMyModel.createLazyFun(),l=s.ExitRoomModel.createLazyFun(),c=s.SharePostModel.createLazyFun(),f=function(){},u="http://"+location.host+"/follow/t.html?",m="http://"+location.host+"/follow/#";return t.extend({onCreate:function(){this.el.html(a),this.el_fribox=this.$(".js_fribox"),this.tpl_friitem=this.$T("#tpl_friitem")},events:{"click .js_fribox i.target":"showPopMenu","click .fri-add":function(){this.forward("friend/add")},"click .js_eyebtn":"toMasterHome","click .js_headsetbtn":"toListenerPlay","click .js_share":"toShare"},_alert:null,_editHandle:f,_historyHandle:f,showPopMenu:function(t){var e=$(t.currentTarget),i=this,a=e.closest("li").attr("data-uid");if(this._editHandle=function(){this.forward("friend/edit?uid="+a+"&from=list")},this._historyHandle=function(){this.getUid(function(t){this.forward("share/master?masterid="+t._id+"&friendid="+a)})},!this._alert){this._alert=new o({hideTitle:!0,content:"请操作",cls:"fri-edit-menu",buttons:[{title:"编辑资料",click:function(){this.hide(),i._editHandle()}},{title:"查看历史",click:function(){this.hide(),i._historyHandle()}},{title:"取消",click:function(){this.hide()}}]});var s=this._alert;this._alert.on("create",function(){this.mask.on("create",function(){this.$el.on("click",function(){s.hide()})})})}this._alert.show()},toShare:function(){var t="share/play?masterid="+this.uid+"&t="+(+new Date+String(Math.random()).replace(".",""));i.send("share",{url:u+t,desc:"此刻，与我同听一首歌",title:"此刻，与我同听一首歌"});var e=c();e.setParam("masterId",this.uid),e.setParam("link",m+t),e.request()},toMasterHome:function(){this.forward("master/home")},toListenerPlay:function(t){var i=$(t.target).closest("li").attr("data-uid"),a=this;this.showLoading(),this.getUid(function(t){e.pause(),setTimeout(function(){var s=l();s.setParam("masterid",t._id),s.request({success:function(t,s){200==s||204==s?setTimeout(function(){e.closeAppSendMessage(),setTimeout(function(){a.forward("listener/play?masterid="+i),a.hideLoading()},100)},100):(this.showToast("小天有点忙，退出再重新进入~",2),this.hideLoading())},error:function(t,e){this.showToast("小天有点忙，退出再重新进入~",2),this.hideLoading()}},this)}.bind(this),50)})},editFriend:function(t){var e=$(t.currentTarget),i=e.closest("li").attr("data-uid");this.forward("friend/edit?uid="+i+"&from=list")},onLoad:function(t){this.setHeader({title:"跟TA一起听",leftHandle:function(){e.backApp()},rightTitle:'<span class="icon-add"></span>加好友',rightHandle:function(){this.forward("friend/add")}}),this.isHeaderHidden()&&this.showHeader();var i="";"index"==t&&(i="notanimte"),this.turning(i),this.showLoading(),this.getUser(function(t){this.loadFriendList(t),this.uid=t._id})},showGuideLayer:function(){var t=this;if("index"===this.$Q("from")){var e=new n({topRightHandle:function(){this.hide(),t.forward("friend/add")}});e.show()}},loadFriendList:function(t){var e=r();e.setParam("uid",t._id),e.request({success:function(e){this._renderFriendList(e.data||[]),this.loopListenersList(t),this.loopMasterList(t),e&&e.data&&e.data.length||this.showGuideLayer()},error:function(){this.showToast("小天有点忙，退出再重新进入~",3)},complete:function(){this.hideLoading()}},this)},_renderFriendList:function(t){this.el_fribox.html(this.tpl_friitem({list:t}))},loopListenersList:function(t){var e=h();e.setParam("uid",t._id),e.loopRequest(5,{success:function(t){this._updateFriendStateOfListener(t.data||[])}},this)},_updateFriendStateOfListener:function(t){var e=this,i={};_.each(t,function(t){i[t.listenerId]=!0;var a=e.el_fribox.find('li[data-uid="'+t.listenerId+'"]');a.find(".fri-state").html("正在听你的歌"),a.find(".fri-btn").hide().filter(".js_eyebtn").show(),a.attr("data-listener","1")});var a=e.el_fribox.find('li[data-listener="1"]');a.each(function(){var t=$(this);i[t.attr("data-uid")]||(t.find(".fri-state").html(""),t.find(".fri-btn").hide(),t.removeAttr("data-listener"))})},loopMasterList:function(t){var e=d();e.setParam("listenerId",t._id),e.loopRequest(2,{success:function(t){this._updateFriendStateOfMaster(t.data||[])}},this)},_updateFriendStateOfMaster:function(t){var e=this,i={};_.each(t,function(t){var a=t.action;if(0===a||1===a||3===a||5===a){i[t.masterId]=!0;var s=e.el_fribox.find('li[data-uid="'+t.masterId+'"]');s.find(".fri-state").html("正在听歌"),s.find(".fri-btn").hide().filter(".js_headsetbtn").show(),s.attr("data-master","1")}});var a=e.el_fribox.find('li[data-master="1"]');a.each(function(){var t=$(this);i[t.attr("data-uid")]||(t.find(".fri-state").html(""),t.find(".fri-btn").hide(),t.removeAttr("data-master"))})},onShow:function(){},onHide:function(){d().endLoopRequest(),h().endLoopRequest()}})});
define("webapp/views/index.js",["webapp/common/baseview","webapp/models/models","webapp/common/app","webapp/stores/stores","ui/slide"],function(require){{var e=require("webapp/common/baseview"),o=(require("webapp/models/models"),require("webapp/common/app"),require("webapp/stores/stores"));require("ui/slide"),o.UserStore.getInstance(),o.FirstStore.getInstance()}return e.extend({onCreate:function(){},onLoad:function(e){this.$;this.turning("notanimte")},onShow:function(){this.forward("home?from=index")},onHide:function(){}})});
define("webapp/views/friend/add.js",["common/funs","webapp/common/baseview","text!webapp/templates/friend/add.html","webapp/common/app","common/url","base/date","webapp/stores/stores","webapp/models/models"],function(require){var e=require("common/funs"),t=require("webapp/common/baseview"),i=require("text!webapp/templates/friend/add.html"),n=require("webapp/common/app"),s=(require("common/url"),require("base/date"),require("webapp/stores/stores")),a=require("webapp/models/models"),o=(s.UserStore.getInstance(),e.createLazyValue(function(){return a.FriendListModel.getInstance()}),e.createLazyValue(function(){return a.UserQRModel.getInstance()})),d=e.createLazyValue(function(){return a.UserInviteModel.getInstance()}),r="http://www.wandoujia.com/apps/com.sds.android.ttpod",c=function(e){var t=e.replace(r+"#",""),i=t.split(","),n={};return _.each(i,function(e){var t=e.split(":");n[t[0]]=t[1]||0}),n};return t.extend({onCreate:function(){this.el.html(i)},events:{"click .topage":"toPage","click .addfriends":"scanQR"},toPage:function(){this.forward("createqr")},onLoad:function(e){var t="";"index"==e&&(t="notanimte"),this.isHeaderHidden()&&this.showHeader(),this.turning(t),this.setHeader({title:"我的二维码",leftHandle:function(){this.back("home")},rightTitle:'<span class="scan-icon"></span>',rightHandle:function(){this.scanQR()}}),this.getUser(function(e){this.createQR(e),this.checkAddFriendsMessage(e)}),this.setBackground("url(./src/style/qr-bg.png) repeat center center","100% auto")},scanQR:function(){this.showLoading(),o().endLoopRequest(),setTimeout(function(){n.scanQR({callback:function(e){this.hideLoading(),e?this.addFriend(e):this.checkAddFriendsMessage()},error:function(){this.hideLoading(),this.checkAddFriendsMessage()},cancel:function(){this.hideLoading(),this.checkAddFriendsMessage()},space:this})}.bind(this),500)},createQR:function(e){var t={};t.source=r+"#to_uid:"+e._id+",qr_id:"+(e.qrCode&&e.qrCode._id),n.createQR(t,{callback:function(e){this.$(".qrbox").html('<img src="data:image/png;base64,'+e.png+'"/>')},error:function(e){},cancel:function(){},space:this})},checkAddFriendsMessage:function(e){function t(e){var t=o();t.setParam("qrid",e.qrCode&&e.qrCode._id),t.loopRequest(3,{success:function(e){e=e||{},e._id&&this.forward(e.register?"friend/confirm?uid="+e._id:"friend/edit?uid="+e._id)}},this)}e?t.call(this,e):this.getUid(t)},addFriend:function(e){e=decodeURIComponent(e),this.showLoading(),this.getUid(function(t){if(e.indexOf("to_uid")>-1&&e.indexOf("qr_id")>-1){var i=c(e),n=d();n.setParam("uid",t._id),n.setParam("to_uid",i.to_uid),n.setParam("qr_id",i.qr_id),n.request({success:function(e,t){200===t?this.forward(e.data.register?"friend/confirm?uid="+e.data._id:"friend/edit?uid="+e.data._id):304===t?this.showToast("对方已经是你的好友！",2):this.showToast("添加好友失败！",2)},error:function(e,t){306===t?this.showToast("好友数量已满，无法添加好友",2):307===t?this.showToast("对方好友数量已满，无法添加好友",2):this.showToast("添加好友失败！",2),this.checkAddFriendsMessage()},complete:function(){this.hideLoading()}},this)}else this.showToast("二维码不正确！",3),this.checkAddFriendsMessage(),this.hideLoading()})},onShow:function(){},onHide:function(){var e=o();e.endLoopRequest()}})});
define("webapp/views/friend/avatar.js",["webapp/common/baseview","text!webapp/templates/friend/avatar.html","webapp/common/app","webapp/stores/stores"],function(require){var t=require("webapp/common/baseview"),e=require("text!webapp/templates/friend/avatar.html"),a=(require("webapp/common/app"),require("webapp/stores/stores")),r=(a.UserStore.getInstance(),a.UserEditStore.createLazyFun());return t.extend({onCreate:function(){this.el.html(e)},events:{"click .topage":"toPage","click .imgbox img":"selectAvatar"},toPage:function(){this.forward("createqr")},selectAvatar:function(t){var e=$(t.currentTarget);r().setAttr("picUrl",e[0].src),r().setAttr("isSelectPic",!0);var a=this.$Q("from");this.back("friend/edit?uid="+this.$Q("uid")+(a?"&from="+a:""))},onLoad:function(){this.setHeader({title:"给TA一个身份",leftHandle:function(){var t=this.$Q("from");this.back("friend/edit?uid="+this.$Q("uid")+(t?"&from="+t:""))},hideRightBtn:!0});var t=r().getAttr("picUrl");if(t){var e=this.$("img");e.each(function(){var e=$(this);this.src===t?e.parent().addClass("cur"):e.parent().removeClass("cur")})}this.turning()},onShow:function(){},onHide:function(){}})});
define("webapp/views/friend/confirm.js",["webapp/common/baseview","text!webapp/templates/friend/confirm.html","webapp/common/app","webapp/stores/stores","webapp/models/models"],function(require){var e=require("webapp/common/baseview"),t=require("text!webapp/templates/friend/confirm.html"),i=require("webapp/common/app"),n=require("webapp/stores/stores"),s=require("webapp/models/models"),o=(n.UserStore.getInstance(),s.UserInfoModel.createLazyFun(),s.MasterInfoModel.createLazyFun()),a=s.MyFriendUserInfoModel.createLazyFun();return e.extend({onCreate:function(){this.el.html(t),this.el_body=this.$(".js-body"),this.tpl_body=_.template(this.$("#tpl-body").html())},events:{"click .topage":"toPage","click .js-play-to-her":"playtoHer","click .js-listener-her":"listenerHer"},playtoHer:function(){i.backApp()},listenerHer:function(){this.showLoading(),this.getUid(function(e){var t=o(),i=this.$Q("uid");t.setParam("masterid",i),t.setParam("listenerId",e._id),t.request({success:function(e){var t=e.data&&e.data.action;this.forward(1===t||3===t?"listener/play?masterid="+i:"home")},error:function(){this.showToast("小天有点忙，退出再重新进入~",3)},complete:function(){this.hideLoading()}},this)})},toPage:function(){this.forward("createqr")},onLoad:function(){this.setHeader({title:"我的好友",leftHandle:function(){this.back("friend/list")},hideRightBtn:!0}),this.updateUserPanl(),this.turning()},updateUserPanl:function(){this.showLoading();var e=this.$Q("uid");this.getUid(function(t){var i=a();i.setParam("uid",t._id),i.setParam("friendid",e),i.request({success:function(e){this.el_body.html(this.tpl_body(e))},error:function(){this.showToast("小天有点忙，退出再重新进入~")},complete:function(){this.hideLoading()}},this)})},onShow:function(){},onHide:function(){}})});
define("webapp/views/friend/edit.js",["webapp/common/baseview","text!webapp/templates/friend/edit.html","webapp/common/app","webapp/stores/stores","webapp/models/models","common/funs"],function(require){{var t=require("webapp/common/baseview"),e=require("text!webapp/templates/friend/edit.html"),i=(require("webapp/common/app"),require("webapp/stores/stores")),n=require("webapp/models/models"),r=(require("common/funs"),i.UserEditStore.createLazyFun()),a=n.UserEditModel.createLazyFun(),s=n.MyFriendUserInfoModel.createLazyFun();i.UserStore.getInstance()}return t.extend({onCreate:function(){this.el.html(e),this.el_body=this.$(".js_body"),this.tpl_body=_.template(this.$("#tpl-body").html())},events:{"click .topage":"toPage","click input":function(t){t.currentTarget.focus()},"click .pic":"switchPic","click .select-avatar":"switchPic","input #nickname":"onInput"},toPage:function(){this.forward("createqr")},onInput:function(t){var e=$(t.currentTarget),i=r();i.setAttr("nickName",e.val())},switchPic:function(){var t=this.$Q("from");this.forward("friend/avatar?uid="+this.$Q("uid")+(t?"&from="+t:""));var e=r();e.setAttr("uid",this.$Q("uid"))},onLoad:function(t){{var e=this.$Q("uid");this.$Q("from")}if(!e)return void this.forward("index");var i=r();i.setAttr("uid",e),this.setHeader({title:"给TA个身份",leftHandle:function(){this.back("home")},rightTitle:"完成",rightHandle:function(){this.nextStep()}}),this.updatePage(t),this.turning()},updatePage:function(t){var e=this.$Q("uid"),i=r();-1==["friend/edit","friend/avatar"].indexOf(t)?(this.showLoading(),this.getUid(function(t){var n=s();n.setParam("uid",t._id),n.setParam("friendid",e),n.request({success:function(t){var e=t.data||{};i.setAttr("nickName",e.nickName),i.setAttr("picUrl",e.pic),this.renderPage()},error:function(){this.renderPage()},complete:function(){this.hideLoading()}},this)})):this.renderPage()},nextStep:function(){var t=r(),e=t.getAttr("uid"),i=t.getAttr("picUrl"),n=t.getAttr("nickName");return i?n?(this.showLoading(),void this.getUid(function(t){var r=a();r.setParam("nick_name",n),r.setParam("pic",i),r.setParam("to_uid_id",e),r.setParam("uid",t._id),r.request({success:function(t){this.hideLoading();var i=this.$Q("from");"list"==i?this.back("home"):this.forward("friend/confirm?uid="+e)},error:function(){this.hideLoading()},cancel:function(){this.hideLoading()}},this)})):void this.showToast("请输入昵称!",3):void this.showToast("请选择头像!",3)},renderPage:function(t){var t=r().get()||{};this.el_body.html(this.tpl_body({user:t}))},onShow:function(){},onHide:function(){}})});
define("webapp/views/master/home.js",["webapp/common/baseview","common/lrcview","webapp/common/app","text!webapp/templates/master/home.html","webapp/common/userslide","webapp/models/models","base/log"],function(require){var e=require("webapp/common/baseview"),t=require("common/lrcview"),i=require("webapp/common/app"),s=require("text!webapp/templates/master/home.html"),n=require("webapp/common/userslide"),o=require("webapp/models/models"),a=require("base/log"),r=o.ListenerOfMyModel.createLazyFun(),l=o.MasterInfoModel.createLazyFun(),c=o.LrcDownloadModel.createLazyFun(),u="header-opacity";return e.extend({onCreate:function(){this.el.html(s),this.el_bg=this.$(".js_bg"),this.el_songinfo=this.$(".js_songinfo"),this.el_lrcbox=this.$(".js_lrcbox")},events:{"click .topage":"toPage"},toPage:function(){this.forward("friend/list")},onLoad:function(e){this.setHeader({title:"我们在听",leftHandle:function(){this.back("home")},rightTitle:'<span class="icon-share"></span>',rightHandle:function(){this.getUid(function(e){this.forward("share/master?masterid="+e._id)})}}),this.createSlide(),this.getUid(function(e){this.uploadListenerList(e),this.uploadMasterStatus(e)}),this.isHeaderHidden()&&this.showHeader();var t="";"index"==e&&(t="notanimte"),this.turning(t)},uploadListenerList:function(e){var t=r();t.setParam("uid",e._id),t.loopRequest(5,{success:function(e){this.renderListenerList(e.data)},error:function(){},complete:function(){}},this)},lastIds:"none",renderListenerList:function(e){var t=_.map(e,function(e){e.listenerId}).join(",");this.lastIds!=t&&(this.slide.setUserItems(this.formatUserItems(e)),this.slide.update()),this.lastIds=t},formatUserItems:function(e){return _.map(e,function(e){return{nickname:e.nickName,pic:e.picUrl||defaultHand}})},createSlide:function(){this.slide=this.slide=new n({container:this.$(".h-listenlist-box"),userItems:[]}),this.slide.show()},uploadMasterStatus:function(e){var t=l();t.setParam("masterid",e._id),this.showLoading(),t.request({success:function(e){this.updateSongInfo(e.data||{})},complete:function(){this.hideLoading()}},this)},updateSongInfo:function(e){e.albumPicUrl?this.setBackground("url("+e.albumPicUrl+") no-repeat center center","auto 100%"):this.setBackground("url("+defaultCover+") no-repeat center center","100% 100%!important"),this.el_songinfo.html((e.songName||"")+" "+(e.singerName||"")),e.albumPicUrl&&this.getRootBg().css({"-webkit-filter":"blur(5px)",filter:"blur(5px)"}),this.uploadLrc(e.songId)},lrcview:null,uploadLrc:function(e){var i=c(),s=this;i.setParam("id",e),i.request({success:function(e){e=e.replace(/<[^<>]+>/g,""),window.lrcview=s.lrcview=new t({wraper:s.el_lrcbox,lrc:e}),s.listenAppPlayStatus()},error:function(){window.lrcview=s.lrcview=new t({wraper:s.el_lrcbox,lrc:"[00:00.00]未匹配到歌词，随着节拍哼唱吧~"}),s.endListenAppPlayStatus()}})},listenAppPlayStatus:function(){i.listenPlayInfo({callback:function(e){a.log(JSON.stringify(e)),this.lrcview.pos(parseInt(e.position/1e3))},error:function(){}},this)},endListenAppPlayStatus:function(){i.unListenPlayInfo({callback:function(){},error:function(){}})},onShow:function(){this.getHeaderRoot().addClass(u)},onHide:function(){this.getHeaderRoot().removeClass(u),this.endListenAppPlayStatus(),r().endLoopRequest()}})});
define("webapp/views/listener/play.js",["webapp/common/baseview","text!webapp/templates/listener/play.html","webapp/models/models","common/lrcview","base/log","webapp/common/app"],function(require){var t=require("webapp/common/baseview"),e=require("text!webapp/templates/listener/play.html"),s=require("webapp/models/models"),a=require("common/lrcview"),i=require("base/log"),n=require("webapp/common/app"),o="header-opacity",r=s.MasterInfoModel.createLazyFun(),l=s.ListenerHeartBeatModel.createLazyFun(),c=s.ListenerLeaveModel.createLazyFun(),h=s.LrcDownloadModel.createLazyFun();return t.extend({onCreate:function(){this.el.html(e),this.el_bgimg=this.$(".js_bgimg"),this.el_name=this.$(".js_name"),this.el_avatar=this.$(".js_avatar"),this.el_songinfo=this.$(".js_songinfo"),this.el_lrcbox=this.$(".js_lrcbox")},events:{"click .topage":"toPage"},toPage:function(){this.forward("friend/list")},userInfo:{},onLoad:function(){var t=this;this.playstatus="none",this.setHeader({title:"我们在听",leftHandle:function(){this.showAlert("退出将无法一起听歌~",[{title:"退出",click:function(){this.hide(),t.back("home")}},{title:"取消",click:function(){this.hide()}}])},hideRightBtn:!0}),this.masterId=this.$Q("masterid"),this.getUid(function(t){this.uploadMasterInfo(this.masterId,t._id),this.loopMasterStatus(this.masterId,t._id)}),this.el_avatar.hide(),this.turning("notanimte")},uploadMasterInfo:function(t,e){this.showLoading();var s=r();s.setParam("masterid",t),s.setParam("listenerId",e),s.setType("GET"),s.request({success:function(t){t&&t.data?(this.userInfo=t.data,this.renderMasterInfo(t.data)):this.showToast("TA已经停止播放了~!",3)},error:function(){this.showToast("TA已经停止播放了~!",3)},complete:function(){this.hideLoading()}},this)},renderMasterInfo:function(t){t.albumPicUrl?this.setBackground("url("+t.albumPicUrl+") no-repeat center center"):this.setBackground("url("+defaultCover+") no-repeat center center","100% 100%!important"),t.albumPicUrl&&this.getRootBg().css({"-webkit-filter":"blur(5px)",filter:"blur(5px)"}),this.el_name.html(t.nickName),this.el_avatar.attr("src",t.picUrl||defaultHand),this.el_avatar.show(),this.el_songinfo.html(t.songName+" - "+t.singerName)},loopMasterStatus:function(t,e){var s=r();s.setParam("masterid",t),s.setParam("listenerId",e);var a=!0;s.loopRequest(2,{success:function(t){this.userInfo=t.data,this.controPlay(t.data,a),a=!1}},this);var i=l();i.setParam("masterid",t),i.setParam("listenerId",e),i.loopRequest(60,{success:function(t){}})},playstatus:"none",checkChnage:function(t){var e=!1,s=[t.songId,t.position,t.action,t.time].join(",");return s!=this.playstatus&&(e=!0),this.playstatus=s,e},controPlay:function(t,e){if(this.checkChnage(t)||e)switch(t.action){case 0:case 1:case 3:case 5:var s=this.lastPlayInfo&&this.lastPlayInfo.songId==t.songId&&this.lastPlayInfo.action==t.action&&this.lastPlayInfo.time==t.time;s?n.resume():n.play({song_id:t.songId,position:t.position}),this.uploadLrc(t.songId),this.renderMasterInfo(t);break;case 2:n.pause();break;case 4:}this.lastPlayInfo=t},lastPlayInfo:null,lrcview:null,uploadLrc:function(t){var e=h(),s=this;e.setParam("id",t),e.request({success:function(t){t=t.replace(/<[^<>]+>/g,""),s.lrcview=new a({wraper:s.el_lrcbox,lrc:t}),s.listenAppPlayStatus()},error:function(){s.lrcview=new a({wraper:s.el_lrcbox,lrc:"[00:00.00]未匹配到歌词，随着节拍哼唱吧~"}),s.endListenAppPlayStatus()}})},listenAppPlayStatus:function(){var t=this;n.listenPlayInfo({callback:function(e){i.log(JSON.stringify(e.position)),t.lrcview.pos(parseInt(e.position/1e3))},error:function(){}},this)},endListenAppPlayStatus:function(){n.unListenPlayInfo({callback:function(){},error:function(){}})},onShow:function(){this.getHeaderRoot().addClass(o)},onHide:function(){this.getHeaderRoot().removeClass(o),n.pause(),r().endLoopRequest(),l().endLoopRequest(),setTimeout(function(){this.endListenAppPlayStatus()}.bind(this),100),this.getUid(function(t){var e=c();e.setParam("masterid",this.masterId),e.setParam("listenerId",t._id),e.setType("DELETE"),e.request()})}})});
define("webapp/views/share/master.js",["base/base","webapp/common/app","webapp/common/baseview","text!webapp/templates/share/master.html","webapp/common/userslide","webapp/models/models"],function(require){var t=require("base/base"),e=require("webapp/common/app"),i=require("webapp/common/baseview"),s=require("text!webapp/templates/share/master.html"),n=(require("webapp/common/userslide"),require("webapp/models/models")),a=n.FriendListModel.createLazyFun(),o="header-opacity";return i.extend({onCreate:function(){this.el.html(s),this.el_listeners=this.$(".sh-listeners"),this.el_infobox=this.$(".sh-info-box"),this.tpl_listeners=_.template(this.$("#tpl_listeners").html()),this.tpl_listen_info=_.template(this.$("#tpl_listen_info").html()),this.itemwidth=100},events:{"click .topage":"toPage"},toPage:function(){this.forward("friend/list")},onLoad:function(){var t=this;this.setHeader({title:"",leftHandle:function(){this.back(this.friendid?"home":"master/home")},rightTitle:'<span class="icon-share"></span>',rightHandle:function(){this.getHeaderRoot().css("visibility","hidden"),setTimeout(function(){t.getHeaderRoot().css("visibility","visible")},3e3),e.share({callback:function(){},error:function(){t.showToast("图片生成失败，再试试",3)}})}}),this.masterid=this.$Q("masterid"),this.friendid=this.$Q("friendid"),this.uploadMasterData(this.masterid,this.friendid),this.setBackground("url("+defaultCover+") repeat center center","100% 100%!important"),this.turning("notanimte")},uploadMasterData:function(t,e){var i=a();i.setParam("uid",t),this.showLoading(),i.request({success:function(t){this.renderMasterData(t.data,e)},error:function(){this.showToast("小天有点忙，退出再重新进入~",3)},complete:function(){this.hideLoading()}},this)},renderMasterData:function(e,i){if(e=e||[],i&&(e=_.filter(e,function(t){return t._id==i})),this.el_listeners.html(this.tpl_listeners({list:e})),this.el_listeners.find("img").on("error",function(){this.src=defaultHand}),e&&e.length){var s=0,n=0,a="",o=defaultCover;t.each(e,function(t){t=t.masterStatistic||{},s+=t.cumDuration||0,n+=t.cumCount||0,t.goldSongName&&(a=t.goldSongName)}),s=parseInt(s/60)}this.itemwidth=100/(e.length||1),this.el_infobox.html(this.tpl_listen_info({songs:n,totalTime:s,songName:a,albumpic:o})),this.el_listeners.find("li").width(this.itemwidth+"%"),e.length>=5&&this.el_listeners.find(".sh-name").hide()},onShow:function(){this.getHeaderRoot().addClass(o)},onHide:function(){this.getHeaderRoot().removeClass(o)}})});
define("webapp/views/share/play.js",["webapp/common/baseview","text!webapp/templates/share/play.html","webapp/models/models","common/lrcview","base/log","webapp/common/app","common/audioplay","webapp/common/oldapp"],function(require){var t=require("webapp/common/baseview"),e=require("text!webapp/templates/share/play.html"),s=require("webapp/models/models"),a=require("common/lrcview"),i=(require("base/log"),require("webapp/common/app"),require("common/audioplay")),o=require("webapp/common/oldapp"),n="header-opacity",r=s.MasterInfoModel.createLazyFun(),l=(s.ListenerHeartBeatModel.createLazyFun(),s.ListenerLeaveModel.createLazyFun(),s.LrcDownloadModel.createLazyFun()),h=s.SongSerachModel.createLazyFun(),c=s.SharePvCountPutModel.createLazyFun(),u=s.SharePvCountGetModel.createLazyFun(),p=navigator.userAgent.match(/ios|ipad|iphone|ipod/i)?"http://www.ttpod.com/head/platdown?platformCode=s300":"http://www.ttpod.com/head/platdown?platformCode=s200";return t.extend({onCreate:function(){this.el.html(e),this.el_bgimg=this.$(".js_bgimg"),this.el_name=this.$(".js_name"),this.el_avatar=this.$(".js_avatar"),this.el_songinfo=this.$(".js_songinfo"),this.el_lrcbox=this.$(".js_lrcbox"),this.audioplay=new i,this.el_playstatus=this.$(".play-status"),this.el_statususerempty=this.$(".status-user-empty")},events:{"click .js_openapp":"toOpenApp"},toOpenApp:function(){var t=this;o.send(""),this.showLoading(),setTimeout(function(){this.hideLoading(),this.showAlert("没有安装app，是否跳转下载?",[{title:"确定",click:function(){t.showLoading(),this.hide(),window.location.href=p}},{title:"取消",click:function(){this.hide()}}]),setTimeout(function(){this.hideAlert()}.bind(this),3e3)}.bind(this),2e3)},userInfo:{},onLoad:function(){this.playstatus="none",this.setBackground("url("+defaultCover+") no-repeat center center","100% 100%!important"),this.el_playstatus.hide(),this.el_statususerempty.show();this._setHeader(2),this.masterId=this.$Q("masterid"),this.loopMasterStatus(this.masterId),this.el_avatar.hide(),this.turning("notanimte"),this.hideToast();var t=c();t.setParam("link",location.href),t.request({success:function(){this.loadListenerSize()}},this)},_setHeader:function(t){this.setHeader({cls:"center-header",title:t+"个好友一起听",hideRightBtn:!0,hideLeftBtn:!0})},uploadMasterInfo:function(t){this.showLoading();var e=r();e.setParam("masterid",t),e.setType("GET"),e.request({success:function(t){t&&t.data?(this.userInfo=t.data,this.renderMasterInfo(t.data)):this.showToast("TA已经停止播放了~!",3)},error:function(){this.showToast("TA已经停止播放了~!",3)},complete:function(){this.hideLoading()}},this)},renderMasterInfo:function(t){t.albumPicUrl?this.setBackground("url("+t.albumPicUrl+") no-repeat center center","auto 100%!important"):this.setBackground("url("+defaultCover+") no-repeat center center","100% 100%!important"),t.albumPicUrl&&this.getRootBg().css({"-webkit-filter":"blur(5px)",filter:"blur(5px)"}),this.el_name.html(t.nickName),this.el_avatar.attr("src",t.picUrl||defaultHand),this.el_avatar.show(),this.$(".l-songname").html(t.songName),this.$(".l-singler").html(t.singerName)},loopMasterStatus:function(t){var e=r();e.setParam("masterid",t);var s=!0;e.loopRequest(2,{success:function(t){this.userInfo=t.data,this.controPlay(t.data,s),s=!1}},this)},playstatus:"none",checkChnage:function(t){var e=!1,s=[t.songId,t.position,t.action,t.time].join(",");return s!=this.playstatus&&(e=!0),this.playstatus=s,e},controPlay:function(t,e){if(this.checkChnage(t)||e)switch(t.action){case 0:case 1:case 3:case 5:var s=this.lastPlayInfo&&this.lastPlayInfo.songId==t.songId&&this.lastPlayInfo.action==t.action&&this.lastPlayInfo.time==t.time;s?this.audioplay.play():this.loadSong(t.songId,function(t){this.audioplay.setSrc(t),this.audioplay.play()}),this.uploadLrc(t.songId),this.renderMasterInfo(t),this.el_playstatus.show(),this.el_statususerempty.hide();break;case 2:this.audioplay.pause(),this.el_playstatus.hide(),this.el_statususerempty.show();break;case 4:this.el_playstatus.hide(),this.el_statususerempty.show()}this.lastPlayInfo=t},lastPlayInfo:null,lrcview:null,uploadLrc:function(t){var e=l(),s=this;e.setParam("id",t),e.request({success:function(t){t=t.replace(/<[^<>]+>/g,""),s.lrcview=new a({wraper:s.el_lrcbox,lrc:t}),s.listenAppPlayStatus()},error:function(){s.lrcview=new a({wraper:s.el_lrcbox,lrc:"[00:00.00]未匹配到歌词，随着节拍哼唱吧~"})}})},listenAppPlayStatus:function(){var t=this;this.audioplay.on("all",function(){var e=parseInt(this.audioplay.getCurPos());t.lrcview.pos(e)}.bind(this))},loadSong:function(t,e){var s=h();s.setParam("song_id",t),s.request({success:function(t){var s=t&&t.data&&t.data[0],a=s&&s.url_list&&(s.url_list[1]||s.url_list[0]||{}).url;e&&e.call(this,a)}},this)},loadListenerSize:function(){var t=u();t.setParam("link",location.href),t.loopRequest(5,{success:function(t){var e=parseInt(t&&t.data)||2;e=2>e?2:e,this._setHeader(e)}},this)},onShow:function(){this.getHeaderRoot().addClass(n)},onHide:function(){this.getHeaderRoot().removeClass(n),this.audioplay.pause(),r().endLoopRequest()}})});