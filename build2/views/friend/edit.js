define("webapp/views/friend/edit.js",["webapp/common/baseview","text!webapp/templates/friend/edit.html","webapp/common/app","webapp/stores/stores","webapp/models/models","common/funs"],function(require){{var t=require("webapp/common/baseview"),e=require("text!webapp/templates/friend/edit.html"),i=(require("webapp/common/app"),require("webapp/stores/stores")),n=require("webapp/models/models"),r=(require("common/funs"),i.UserEditStore.createLazyFun()),a=n.UserEditModel.createLazyFun(),s=n.MyFriendUserInfoModel.createLazyFun();i.UserStore.getInstance()}return t.extend({onCreate:function(){this.el.html(e),this.el_body=this.$(".js_body"),this.tpl_body=_.template(this.$("#tpl-body").html())},events:{"click .topage":"toPage","click input":function(t){t.currentTarget.focus()},"click .pic":"switchPic","click .select-avatar":"switchPic","input #nickname":"onInput"},toPage:function(){this.forward("createqr")},onInput:function(t){var e=$(t.currentTarget),i=r();i.setAttr("nickName",e.val())},switchPic:function(){var t=this.$Q("from");this.forward("friend/avatar?uid="+this.$Q("uid")+(t?"&from="+t:""));var e=r();e.setAttr("uid",this.$Q("uid"))},onLoad:function(t){{var e=this.$Q("uid");this.$Q("from")}if(!e)return void this.forward("index");var i=r();i.setAttr("uid",e),this.setHeader({title:"给TA个身份",leftHandle:function(){this.back("home")},rightTitle:"完成",rightHandle:function(){this.nextStep()}}),this.updatePage(t),this.turning()},updatePage:function(t){var e=this.$Q("uid"),i=r();-1==["friend/edit","friend/avatar"].indexOf(t)?(this.showLoading(),this.getUid(function(t){var n=s();n.setParam("uid",t._id),n.setParam("friendid",e),n.request({success:function(t){var e=t.data||{};i.setAttr("nickName",e.nickName),i.setAttr("picUrl",e.pic),this.renderPage()},error:function(){this.renderPage()},complete:function(){this.hideLoading()}},this)})):this.renderPage()},nextStep:function(){var t=r(),e=t.getAttr("uid"),i=t.getAttr("picUrl"),n=t.getAttr("nickName");return i?n?(this.showLoading(),void this.getUid(function(t){var r=a();r.setParam("nick_name",n),r.setParam("pic",i),r.setParam("to_uid_id",e),r.setParam("uid",t._id),r.request({success:function(t){this.hideLoading();var i=this.$Q("from");"list"==i?this.back("home"):this.forward("friend/confirm?uid="+e)},error:function(){this.hideLoading()},cancel:function(){this.hideLoading()}},this)})):void this.showToast("请输入昵称!",3):void this.showToast("请选择头像!",3)},renderPage:function(t){var t=r().get()||{};this.el_body.html(this.tpl_body({user:t}))},onShow:function(){},onHide:function(){}})});