define("webapp/views/share/master.js",["base/base","webapp/common/app","webapp/common/baseview","text!webapp/templates/share/master.html","webapp/common/userslide","webapp/models/models"],function(require){var t=require("base/base"),e=require("webapp/common/app"),i=require("webapp/common/baseview"),s=require("text!webapp/templates/share/master.html"),n=(require("webapp/common/userslide"),require("webapp/models/models")),a=n.FriendListModel.createLazyFun(),o="header-opacity";return i.extend({onCreate:function(){this.el.html(s),this.el_listeners=this.$(".sh-listeners"),this.el_infobox=this.$(".sh-info-box"),this.tpl_listeners=_.template(this.$("#tpl_listeners").html()),this.tpl_listen_info=_.template(this.$("#tpl_listen_info").html()),this.itemwidth=100},events:{"click .topage":"toPage"},toPage:function(){this.forward("friend/list")},onLoad:function(){var t=this;this.setHeader({title:"",leftHandle:function(){this.back(this.friendid?"home":"master/home")},rightTitle:'<span class="icon-share"></span>',rightHandle:function(){this.getHeaderRoot().css("visibility","hidden"),setTimeout(function(){t.getHeaderRoot().css("visibility","visible")},3e3),e.share({callback:function(){},error:function(){t.showToast("图片生成失败，再试试",3)}})}}),this.masterid=this.$Q("masterid"),this.friendid=this.$Q("friendid"),this.uploadMasterData(this.masterid,this.friendid),this.setBackground("url("+defaultCover+") repeat center center","100% 100%!important"),this.turning("notanimte")},uploadMasterData:function(t,e){var i=a();i.setParam("uid",t),this.showLoading(),i.request({success:function(t){this.renderMasterData(t.data,e)},error:function(){this.showToast("小天有点忙，退出再重新进入~",3)},complete:function(){this.hideLoading()}},this)},renderMasterData:function(e,i){if(e=e||[],i&&(e=_.filter(e,function(t){return t._id==i})),this.el_listeners.html(this.tpl_listeners({list:e})),this.el_listeners.find("img").on("error",function(){this.src=defaultHand}),e&&e.length){var s=0,n=0,a="",o=defaultCover;t.each(e,function(t){t=t.masterStatistic||{},s+=t.cumDuration||0,n+=t.cumCount||0,t.goldSongName&&(a=t.goldSongName)}),s=parseInt(s/60)}this.itemwidth=100/(e.length||1),this.el_infobox.html(this.tpl_listen_info({songs:n,totalTime:s,songName:a,albumpic:o})),this.el_listeners.find("li").width(this.itemwidth+"%"),e.length>=5&&this.el_listeners.find(".sh-name").hide()},onShow:function(){this.getHeaderRoot().addClass(o)},onHide:function(){this.getHeaderRoot().removeClass(o)}})});